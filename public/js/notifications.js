let notificationPopover;async function makePostRequest(t){return await fetch(t,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}}).catch(function(t){console.log("Failed to fetch page: ",t)})}export async function updateNotifications(){return await fetch("/api/notifications/",{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(t){return t.text()}).then(function(t){notificationPopover._config.content=t,notificationPopover.setContent(),dismissNotificationsButton()}).catch(function(t){console.log("Failed to fetch page: ",t)})}export async function updateNotificationCount(){return await fetch("/api/notifications/count",{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(t){return t.text()}).then(function(t){let e=document.getElementById("notification-button"),n=document.getElementById("notification-count");if(e&&t>0){if(e&&n)n.innerHTML=t;else if(e){let o=document.createElement("span");o.id="notification-count",o.classList="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger",o.innerHTML=t;let i=document.createElement("span");i.classList="visually-hidden",i.innerHTML="unread messages",e.appendChild(o),o.appendChild(i)}}else e&&n&&0==t&&clearNotificationCount()}).catch(function(t){console.log("Failed to fetch page: ",t)})}export function update(){updateNotifications(),updateNotificationCount()}export function notificationPopup(t,e){let n=document.getElementsByTagName("main")[0],o=document.createElement("div");o.classList="alert alert-dismissible alert-dismissable alert-info position-absolute bottom-0 end-0 m-5 d-flex flex-row";let i=document.createElement("button");i.type="button",i.classList="btn-close",i.dataset.bsDismiss="alert",i.addEventListener("click",t=>{t.preventDefault()});let a=document.createElement("strong");a.innerHTML=e.message+".\xa0";let s=document.createElement("a");s.classList="alert-link",s.href=t,n.appendChild(s),s.appendChild(o),o.appendChild(i),o.appendChild(a)}export function markQuestionNotifRead(){let t=window.location.href.split("/").pop();makePostRequest("/notifications/read/question/"+t),updateNotificationCount()}function upvotePopup(t){console.log(`New upvote: ${t.message}`);let e="/questions/";switch(t.vote.type){case"ANSWER":e+=t.vote.content.question_id;break;case"QUESTION":e+=t.vote.question_id}notificationPopup(e,t)}function commentPopup(t){console.log(`New comment: ${t.message}`);let e="/questions/";switch(t.comment.type){case"ANSWER":e+=t.comment.content.question_id;break;case"QUESTION":e+=t.comment.question_id}console.log(`${e}`),notificationPopup(e,t)}function answerPopup(t){console.log(`New answer: ${t.message}`);notificationPopup("/questions/"+t.question.id,t)}export function clearNotificationCount(){let t=document.getElementById("notification-button"),e=document.getElementById("notification-count");t&&e&&t.removeChild(e)}export function notificationButton(){let t=document.getElementById("notification-button");t&&t.addEventListener("click",t=>{makePostRequest("/notifications/read"),clearNotificationCount()})}export function dismissNotificationsButton(){let t=document.getElementById("dismiss-notifications");t&&t.addEventListener("click",function(t){makePostRequest("/notifications/delete"),update()})}export default function t(){Pusher.logToConsole=!0;let t=new Pusher("37abc4ec3e719eac9ea4",{cluster:"eu",encrypted:!0,authEndpoint:"/broadcasting/auth",forceTLS:!0});if(""!==userId){let e="private-user-"+userId,n=t.subscribe(e);document.getElementsByTagName("main")[0],n.bind("notification-upvote",function(t){upvotePopup(t),update()}),n.bind("notification-answer",function(t){answerPopup(t),update()})}notificationButton();0!==document.querySelectorAll('[data-bs-toggle="popover"]').length&&document.addEventListener("DOMContentLoaded",function(){[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')).map(function(t){return notificationPopover=new bootstrap.Popover(t,{template:'<div class="popover"><div class="popover-arrow"></div><h3 class="popover-header">Notifications</h3><div id="popover-body-notifications" class="popover-body list-group d-flex flex-column list-unstyled p-0"></div></div>',container:"body",html:!0,placement:"bottom"}),updateNotifications(),t.addEventListener("hidden.bs.popover",updateNotifications),notificationPopover}),notificationPopover._element.addEventListener("shown.bs.popover",function(t){let e=document.getElementById("dismiss-notifications");e&&e.addEventListener("click",function(t){makePostRequest("/notifications/delete"),update()});let n=document.getElementsByClassName("dismiss-notification");for(let o of n)o.addEventListener("click",function(t){let e=t.target.parentElement.id.split("-").pop();makePostRequest("/notifications/delete/"+e),update()})}),document.addEventListener("click",function(t){t.target.closest(".popover")||notificationPopover.hide()})})};