import e from"./reset-field.js";let create_tag_modal=document.getElementById("create-tag"),edit_tag_modal=document.getElementById("edit-tag");async function fetchTags(){let e=await fetch("/api/tags/all"),t=await e.json();return t.forEach(e=>{e.value=e.id,delete e.id,delete e.description,delete e.search_tag_description,delete e.search_tag_name}),t}function suggestionItemTemplate(e){return`
      <div ${this.getAttributes(e)}
          class='tagify__dropdown__item ${e.class?e.class:""}'
          tabindex="0"
          role="option">
          <p class="tagify-text m-0">${e.name}${e.approved?"":" <small>(Pending approval)</small>"}</p>
      </div>
  `}export default async function t(){let t=document.getElementById("tag-input");t&&(t=new Tagify(document.getElementById("tag-input"),{tagTextProp:"name",whitelist:await fetchTags(),enforceWhitelist:!0,skipInvalid:!0,dropdown:{enabled:0,closeOnSelect:!1,searchKeys:["name",]},autocomplete:{enabled:1},templates:{dropdownItem:suggestionItemTemplate}}));let a=document.getElementById("edit-error"),l=document.getElementById("create-error"),n=document.getElementById("last-created-tag");if(n&&""!=n.value){let o=t.whitelist.find(e=>e.value==n.value);t.addTags([o])}document.getElementById("open-modal").onclick=function(){create_tag_modal.style.display="block"},document.querySelectorAll(".edit-tag").forEach(t=>{t.onclick=function(){let a=t.parentElement.parentElement;edit_tag_modal.querySelector(".id").value=a.children[0].textContent,edit_tag_modal.querySelector(".name input").value=a.children[1].textContent,edit_tag_modal.querySelector(".description textarea").value=a.children[2].textContent,edit_tag_modal.style.display="block",e(["#edit-tag .name","#edit-tag .description"])}}),document.querySelectorAll(".close-modal").forEach(e=>{e.onclick=closeModals}),window.onclick=function(e){e.target==create_tag_modal?closeModals():e.target==edit_tag_modal&&closeModals()},a&&""!=a.value?document.querySelectorAll(".edit-tag").forEach(e=>{e.parentElement.parentElement.children[0].textContent==a.value&&e.click()}):""!=l.value&&(create_tag_modal.style.display="block")};function closeModals(){create_tag_modal&&(create_tag_modal.style.display="none"),edit_tag_modal&&(edit_tag_modal.style.display="none"),document.querySelectorAll(".text-danger").forEach(e=>{e.textContent=""})}function updateAction(e,t){let a=new URL(e);return a.pathname=a.pathname.replace(/\/tags\/\d+/,"/tags/"+t),a.toString()}